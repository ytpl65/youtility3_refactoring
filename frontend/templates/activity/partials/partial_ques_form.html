{% extends "partial_base.html" %}

{% block head %}
{{ ques_form.media.css }}
{% endblock head %}


{% block body %}
<form action="" method="post" id="id_quesform">
    <div class="modal-header border-0">
        <h3 class="modal-title modal-heading" id="exampleModalLabel">Create Question <i
                class="fas fa-poll-h fa-sm ch4"></i></h3>
        <button type="button" class="btn-sm btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body" id="partial">
        <div class="alert alert-danger alert-dismissible fade show" id="nonfield_errors" role="alert"
            style="display:none">
            <strong>Error</strong> <span></span>
            <button type="button" class="btn-sm btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <input type="hidden", value='{{ ques_form.instance.alerton }}' id="hidden_alerton">
        <!--============================== FORM FIELDS START =============================-->
        <div class="row mb-3 gy-3">
            <label for={{ ques_form.ques_name.id_for_label }} class="col-md-1">{{ ques_form.ques_name.label }}:</label>
            <div class="col-md-11">
                {{ ques_form.ques_name }}
                {{ ques_form.ques_name.errors }}
            </div>
            <label for={{ ques_form.answertype.id_for_label }} class="col-md-1">{{ ques_form.answertype.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.answertype }}
                {{ ques_form.answertype.errors }}
            </div>
            <label for={{ ques_form.unit.id_for_label }} class="col-md-1">{{ ques_form.unit.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.unit }}
                {{ ques_form.unit.errors }}
            </div>
           <label for={{ ques_form.category.id_for_label }} class="col-md-1">{{ ques_form.category.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.category }}
                {{ ques_form.category.errors }}
            </div>
            <div class="booleans col-md-6 d-flex justify-content-sm-between mt-5
            form-check form-switch form-check-custom form-check-solid">
                <label for="{{ ques_form.isworkflow.id_for_label }}"
                    class="form-check-label bool col-form-label me-5 text-sm-right">
                    {{ ques_form.isworkflow.label }}: &nbsp; {{ ques_form.isworkflow }}
                </label>
            </div>
        </div>
        
        <div class="row mb-3 gy3 optionGrp" {% if not ques_form.instance.id %} style="display:none;"{% endif %}>
            <label for={{ ques_form.options.id_for_label }} class="col-md-1">{{ ques_form.options.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.options }}
                {{ ques_form.options.errors }}
            </div>
            <label for={{ ques_form.alerton.id_for_label }} class="col-md-1">{{ ques_form.alerton.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.alerton }}
                {{ ques_form.alerton.errors }}
            </div>
        </div>
            
        <div class="row mb-3 gy-3 numeric">
            <label for={{ ques_form.min.id_for_label }} class="col-md-1">{{ ques_form.min.label }}:</label>
            <div class="col-md-4">
                {{ ques_form.min }}
                {{ ques_form.min.errors }}
            </div>
            <label for={{ ques_form.max.id_for_label }} class="col-md-2">{{ ques_form.max.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.max }}
                {{ ques_form.max.errors }}
            </div>
            <label for={{ ques_form.alertbelow.id_for_label }} class="col-md-1">{{ ques_form.alertbelow.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.alertbelow }}
                {{ ques_form.alertbelow.errors }}
            </div>
            <label for={{ ques_form.alertabove.id_for_label }} class="col-md-1">{{ ques_form.alertabove.label }}:</label>
            <div class="col-md-5">
                {{ ques_form.alertabove }}
                {{ ques_form.alertabove.errors }}
            </div>
        </div>
        <!--============================== FORM FIELDS END ============================-->
    </div>
</form>
    <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-sm btn-secondary btn-hover-scale" data-bs-dismiss="modal">
            Close <i class="fas fa-times"></i>
        </button>
        {% if ques_form.instance.id %}
            <button type="submit" id="submit" form= "id_quesform" class="btn btn-sm btn-primary btn-hover-scale">
                Update&nbsp;<i class="fas fa-cloud-upload-alt"></i>
            </button>
            <button type="button" onclick="deleteQuestion(this)" data-id="{{ ques_form.instance.id }}" id="deleteAttd"
                class="btn btn-sm btn-danger btn-hover-scale">
                Delete&nbsp;<i class="fas fa-trash-alt"></i>
            </button>
        {% else %}
            <button type="submit"  form="id_quesform" class="btn btn-sm btn-primary btn-hover-scale">
                Add&nbsp;<i class="fas fa-cloud-upload-alt"></i>
            </button>
        {% endif %}
    </div>
{% endblock body %}


{% block js %}
{{ ques_form.media.js }}
<script>
    //return selected value of a field
    console.log("script loaded")
    function getQuesTypeValue(id){
        var data =  $(id).select2('data')[0]
        if(typeof data !== 'undefined'){
            return data.text
        }
        return "NONE"
    }

    $(document).ready(() => {
        // Initialize Tagify components
        var input1 = document.querySelector("#id_options");
        var optionTag = new Tagify(input1);

        $("#modal-ques").find("select").select2({
            dropdownParent: $('#modal-ques')
        })

        //on change answertype field
        $("#id_answertype.form-select").on("change", function(){
            var selected = getQuesTypeValue("#id_answertype");
            //shows and hides according to questypes
            showHideFields(selected)
        } )

        //option field events
        optionTag
        .on('add', function(e){
            populateAlertOn(e.detail.data.value)
        })
        .on('remove', function(e){
            removeElmtFromAlertOn(e.detail.data.value)
        })

        var initial_selected = $("#id_answertype.form-select").select2('data')[0].text
        //shows and hides according to questypes
        showHideFields(initial_selected)
        if($("#id_options").val().length){
            initialize_alerton_field($("#id_options").val(), $("#hidden_alerton").val(), cleaned=false)
        }
        $(".modal").removeAttr("tabindex");
    })
</script>
{% endblock js %}