{% extends "base_form.html" %}
{% from "onboarding/ta_form.html" import typeassist_form with context %}


<!---- BEGIN PAGE TITLE ---->
{% block title %}
Client Form
{% endblock title %}
<!---- END PAGE TITLE ----->



<!-------------------------- BEGIN PAGE BREADCUMB ----------------------->
{% block pagebreadcumb %}
{{ super() }}
<li class="breadcrumb-item pe-3"><a href="{{ url('onboarding:client_list') }}" class="pe-3">Client List</a></li>
<li class="breadcrumb-item pe-3"><a href="javascript:void(0)" class="pe-3">Client Form</a></li>
{% endblock pagebreadcumb %}
<!-------------------------- END PAGE BREADCUMB ------------------------->


<!-------------  BEGIN POP-UPS CODE -------------->
{% block popup_alerts %}
{{ super()  }}
{% if edit is defined %}
<!-- to delete an instance with popup_alert pass the delete_url_name, instance_id, popup_title, popup_id -->
{% call general_popup(title="Delete", popup_id="delete_alert") %}
<div class="modal-body">
    <h4>Are you sure, you want to delete this?</h4>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">No Go back</button>
    <a href="{{ url('onboarding:client_delete', args=[clientform.instance.id]) }}"
        class="btn btn-sm  btn-danger rounded-1">Yes I'm Sure</a>
</div>
{% endcall %}
{% endif %}
<!------------- typeassist popup for onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "butype_popup") %}
<form action="" method="post" id="pop_butype_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary rounded-1" value="Sumbit" form="pop_butype_form" />
    </div>
</form>
{% endcall %}
{% endblock popup_alerts %}
<!-------------  END POP-UPS CODE -------------->


<!------ BEGIN FORM TITLE ------->
{% block form_title %}
Client
{% endblock form_title %}
<!------ END FORM TITLE -------->


<!--------- BEGIN NON FIELD ERRORS -------->
{% block nonfield_errors %}
{% if clientform.non_field_errors() %}
<div id="non_field_error" class="alert alert-danger" style="width: 73%;">
    {% for error in clientform.non_field_errors() %}
    {{ error }}
    {% endfor %}
    <button type="button" class="btn-close flt-right" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% if clientprefsform.non_field_errors() %}
<div id="non_field_error" class="alert alert-danger" style="width: 73%;">
    {% for error in clientprefsform.non_field_errors() %}
    {{ error }}
    {% endfor %}
    <button type="button" class="btn-close flt-right" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% endblock nonfield_errors %}
<!---------- END NON FIELD ERRORS --------->



<!-------------- BEGIN FORM ------------------->
{% block form %}
<form action="" method='post' id="id_clientform">
    <!-------------------------- CSRF MIDDLEWARE TOKEN --------------------->
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    <div class="mb-3 row g-3 gx-6">
        {{ clientform.identifier.label_tag() }}
        <div class="col-md-4 col-sm-4">
            <div class="d-flex flex-row">
                {{ clientform.identifier }}
                <a href="" type="button" data-bs-toggle="modal" data-bs-target="#butype_popup"><span
                        style="font-size: 24px;" data-bs-toggle="tooltip" data-bs-placement="left"
                        title="If you haven't found an option in selection menu, then create one from here"
                        class="material-icons-outlined mt-3 ps-2 primary-col">
                        add_circle
                    </span></a>
            </div>
            <!----- BEGIN ERROR FIELD  ------->
            {{ clientform.identifier.errors }}
            <!----- END ERROR FIELD  ------->
        </div>
        {{ clientform.bucode.label_tag() }}
        <div class="col-md-4 col-sm-4">
            {{ clientform.bucode }}
            <!--HELP TEXT-->
            {% if clientform.bucode.help_text %}
            <small>{{ clientform.bucode.help_text }}</small>
            {% endif %}
            <!----- BEGIN ERROR FIELD  ------->
            {{ clientform.bucode.errors }}
            <!----- END ERROR FIELD  ------->
        </div>
        {{ clientform.buname.label_tag() }}
        <div class="col-md-4 col-sm-4">
            {{ clientform.buname }}
            <!--HELP TEXT-->
            {% if clientform.buname.help_text %}
            <small>{{ clientform.buname.help_text }}</small>
            {% endif %}
            <!----- BEGIN ERROR FIELD  ------->
            {{ clientform.buname.errors }}
            <!----- END ERROR FIELD  ------->
        </div>

        {{ clientform.parent.label_tag() }}
        <div class="col-md-4 col-sm-4">
            {{ clientform.parent }}
            <!--HELP TEXT-->
            {% if clientform.parent.help_text %}
            <small>{{ clientform.parent.help_text }}</small>
            {% endif %}
            <!----- BEGIN ERROR FIELD  ------->
            {{ clientform.parent.errors }}
            <!----- END ERROR FIELD  ------->
        </div>
        {% for field in clientprefsform %}
        {% if field.name in ['validimei', 'validip', 'reliveronpeoplecount',
                                    'pvideolength'] %}
        <!------LABEL FIELD --->
        {{ field.label_tag() }}
        <div class="col-md-4 col-sm-4">
            {{ field }}
            <!---- HELP TEXT ---->
            {% if field.help_text %}
            <small>{{ field.help_text }}</small>
            {% endif %}

            <!----- BEGIN ERROR FIELD  ----->
            {{ field.errors }}
            <!----- END ERROR FIELD  ------->
        </div>

        {% else %}
        {% endif %}
        {% endfor %}
        <!------------ BEIGN CHECKBOX RENDERING LAST --------------------->
        <div class="booleans col-md-12 d-flex justify-content-sm-between mt-5">
            {% for checkbox_field in clientform %}
            {% if (checkbox_field.widget_type=='checkbox' and checkbox_field.name in [
                    'gpsenable', 'skipsiteaudit', 'deviceevent', 'enablesleepingguard', 'enable'
                ]) %}
            <label for={{ checkbox_field.id_for_label }}
                class="form-check-label bool col-form-label me-5 text-sm-right">{{ checkbox_field }}
                &nbsp{{ checkbox_field.label }}</label>
            {% endif %}
            {% endfor %}
            <label for={{ clientprefsform.usereliver.id_for_label }}
                class="form-check-label bool col-form-label me-5 text-sm-right">{{ clientprefsform.usereliver }}
                &nbsp{{ clientprefsform.usereliver.label }}</label>
        </div>
        <!------------ END CHECKBOX RENDERING LAST ------------------------>
    </div>
    <hr>
</form>
{% endblock form %}

{% block extras %}
<div class="my-3 row g-3 gx-6">
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Web Capability</h4>
        <!---- WEB CAPABILITY FIELD --->
        {{ clientprefsform.webcapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Mobile Capability</h4>
        <!---- MOBILE CAPABILITY FIELD --->
        {{ clientprefsform.mobilecapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Report Capability</h4>
        <!---- REPORT CAPABILITY FIELD --->
        {{ clientprefsform.reportcapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Portlet Capability</h4>
        <!---- PORTLET CAPABILITY FIELD --->
        {{ clientprefsform.portletcapability }}
    </div>

</div>
{% endblock extras %}
<!------------- END FORM ---------------------->


<!------------------- BEGIN FORM PAGE ACTIONS --------------->
{% block page_actions %}
{% if edit is defined %}
{{ form_update('id_clientform', popup_id="delete_alert") }}
{% else %}
{{ form_create('id_clientform') }}
{% endif %}
{% endblock page_actions %}
<!------------------- END FORM PAGE ACTIONS --------------->


{% block extra_scripts %}
{{ clientform.media.js }}
<script>
    $(document).ready(function () {
        //add form attribute to fields which are outside form element
        $("#id_webcapability").attr("form", "id_clientform")
        $("#id_reportcapability").attr("form", "id_clientform")
        $("#id_portletcapability").attr("form", "id_clientform")
        $("#id_mobilecapability").attr("form", "id_clientform")

        //hide the delete button when instance is not saved yet.
        if ('{{clientform.instance.id}}' == 'None') {
            $("#btn_del").hide()
        }

        // submit the popup-butype-taform for validation and saving in db.
        $('#pop_butype_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_butype_form",
            'field': "#id_identifier",
            'modal': "#butype_popup"
        }))
        //for select2 search work in bootstrap modals
        $("#pop_butype_form").find("select[name=tatype]").select2({
            dropdownParent: $('#pop_butype_form')
        })
        //sets closeonSelect to false for multiple-select fields
        $("[multiple]").select2({
            closeOnSelect:false 
        })
       
    })
</script>
{% endblock extra_scripts %}