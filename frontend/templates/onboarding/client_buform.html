{% extends "base_form.html" %}
{% from "onboarding/partials/partial_ta_form.html" import typeassist_form with context %}

<!---- BEGIN PAGE TITLE ---->
{% block title %}
Client Form
{% endblock title %}
<!---- END PAGE TITLE ----->

<!--- START CSS -->
{% block extra_css %}
<link  href="{{ static('assets/plugins/custom/DataTables/datatables.min.css') }}" rel="stylesheet" type="text/css"/>
<link  href="{{ static('assets/plugins/custom/Editor-2.0.8/css/editor.dataTables.min.css') }}" rel="stylesheet" type="text/css"/>
{% endblock extra_css %}
<!--- END CSS -->

<!-------------------------- BEGIN PAGE BREADCUMB ----------------------->
{% block pagebreadcumb %}
{{ super() }}
<li class="breadcrumb-item pe-3"><a href="{{ url('onboarding:client_list') }}" class="pe-3">Client List</a></li>
<li class="breadcrumb-item pe-3"><a href="javascript:void(0)" class="pe-3">Client Form</a></li>
{% endblock pagebreadcumb %}
<!-------------------------- END PAGE BREADCUMB ------------------------->

<!-------------  BEGIN POP-UPS CODE -------------->
{% block popup_alerts %}
{{ super()  }}
{% if edit is defined %}
<!-- to delete an instance with popup_alert pass the delete_url_name, instance_id, popup_title, popup_id -->
{% call general_popup(title="Delete", popup_id="delete_alert") %}
<div class="modal-body">
    <h4>Are you sure, you want to delete this?</h4>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">No Go back</button>
    <a href="{{ url('onboarding:client_delete', args=[clientform.instance.id]) }}"
        class="btn btn-sm  btn-danger rounded-1">Yes I'm Sure</a>
</div>
{% endcall %}
{% endif %}
<!------------- typeassist popup for onclick + icon ---------------------->
{% call general_popup(title='Create TypeAssist', popup_id = "butype_popup") %}
<form action="" method="post" id="pop_butype_form">
    <div class="modal-body">
        <input type="hidden" name="form_name" , value="ta_form">
        {% if ta_form is defined %}
        {{ typeassist_form() }}
        {% endif %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm  btn-secondary rounded-1" data-bs-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-sm  btn-primary rounded-1" value="Sumbit" form="pop_butype_form" />
    </div>
</form>
{% endcall %}
{% endblock popup_alerts %}
<!-------------  END POP-UPS CODE -------------->

<!------ BEGIN FORM TITLE ------->
{% block form_title %}
Client
{% endblock form_title %}
<!------ END FORM TITLE -------->

<!--------- BEGIN NON FIELD ERRORS -------->
{% block nonfield_errors %}
{% if clientform.non_field_errors() %}
<div id="non_field_error" class="alert alert-danger" style="width: 73%;">
    {% for error in clientform.non_field_errors() %}
    {{ error }}
    {% endfor %}
    <button type="button" class="btn-close flt-right" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% if clientprefsform.non_field_errors() %}
<div id="non_field_error" class="alert alert-danger" style="width: 73%;">
    {% for error in clientprefsform.non_field_errors() %}
    {{ error }}
    {% endfor %}
    <button type="button" class="btn-close flt-right" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% endblock nonfield_errors %}
<!---------- END NON FIELD ERRORS --------->


<!-------------- BEGIN FORM ------------------->
{% block form %}
<form action="" method='post' id="id_clientform">
    <!-------------------------- CSRF MIDDLEWARE TOKEN --------------------->
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    <input type="hidden" name="{{ clientform.ctzoffset.name }}" id = "{{ clientform.ctzoffset.auto_id }}" value="-1">
    <div class="mb-3 row g-3 gx-6">
        <div class="col-md-6">
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientform.identifier.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientform.identifier }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientform.bucode.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientform.bucode }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientform.buname.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientform.buname }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientprefsform.validimei.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientprefsform.validimei }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientprefsform.validip.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientprefsform.validip }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientprefsform.reliveronpeoplecount.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientprefsform.reliveronpeoplecount }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientprefsform.pvideolength.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientprefsform.pvideolength }}
                </div>
            </div>
            <div class="input-group mb-3">
                <div class="col-md-4">
                    {{ clientprefsform.validimei.label_tag() }}
                </div>
                <div class="col-md-8">
                    {{ clientprefsform.validimei }}
                </div>
            </div>
        </div>

        <div class="col-md-4 offset-md-2 form-check form-switch form-check-solid">
            <div class="input-group mb-6">
                <label for="{{ clientform.gpsenable.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientform.gpsenable }}&nbsp;&nbsp;{{ clientform.gpsenable.label }}</label>
            </div><br>
            <div class="input-group mb-6">
                <label for="{{ clientform.skipsiteaudit.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientform.skipsiteaudit }}&nbsp;&nbsp;{{ clientform.skipsiteaudit.label }}</label>
            </div><br>
            <div class="input-group mb-6">
                <label for="{{ clientform.deviceevent.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientform.deviceevent }}&nbsp;&nbsp;{{ clientform.deviceevent.label }}</label>
            </div><br>
            <div class="input-group mb-6">
                <label for="{{ clientform.enablesleepingguard.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientform.enablesleepingguard }}&nbsp;&nbsp;{{ clientform.enablesleepingguard.label }}</label>
            </div><br>
            <div class="input-group mb-6">
                <label for="{{ clientform.enable.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientform.enable }}&nbsp;&nbsp;{{ clientform.enable.label }}</label>
            </div><br>
            <div class="input-group mb-6">
                <label for="{{ clientprefsform.usereliver.id_for_label }}" 
                class="form-check-label bool text-sm-right">{{ clientprefsform.usereliver }}&nbsp;&nbsp;{{ clientprefsform.usereliver.label }}</label>
            </div>
        </div>
    </div>
    <hr>
</form>
{% endblock form %}

{% block extras %}
<div class="my-3 row g-3 gx-6">
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Web Capability</h4>
        <!---- WEB CAPABILITY FIELD --->
        {{ clientprefsform.webcapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Mobile Capability</h4>
        <!---- MOBILE CAPABILITY FIELD --->
        {{ clientprefsform.mobilecapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Report Capability</h4>
        <!---- REPORT CAPABILITY FIELD --->
        {{ clientprefsform.reportcapability }}
    </div>
    <div class="col-md-3 col-sm-3">
        <h4 style="color:#3a3b40de">Portlet Capability</h4>
        <!---- PORTLET CAPABILITY FIELD --->
        {{ clientprefsform.portletcapability }}
    </div>
</div>
<br>
<!--List of Buisiness Units --->
<div class="row">
<div class="card">
    <div class="card-header p-0">
        <div class="card-title">
            List of Buisiness Units&nbsp;<i class="fas fa-table ch4"></i>
        </div>
    </div>
    <div class="card-body">
        <table id="list_bu"></table>
    </div>
</div>
</div>
{% endblock extras %}
<!------------- END FORM ---------------------->

<!------------------- BEGIN FORM PAGE ACTIONS --------------->
{% block page_actions %}
{% if edit is defined %}
{{ form_update('id_clientform', popup_id="delete_alert") }}
{% else %}
{{ form_create('id_clientform') }}
{% endif %}
{% endblock page_actions %}
<!------------------- END FORM PAGE ACTIONS --------------->

{% block extra_scripts %}
{{ clientform.media.js }}
<script src="{{ static('assets/plugins/custom/DataTables/datatables.min.js') }}" type="text/javascript"></script>
<script src="{{ static('assets/plugins/custom/Editor-2.0.8/js/editor.datatables.min.js') }}" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        //set ctzoffset
  	    $("#id_ctzoffset").val(-new Date().getTimezoneOffset())
        
        //add form attribute to fields which are outside form element
        $("#id_webcapability").attr("form", "id_clientform")
        $("#id_reportcapability").attr("form", "id_clientform")
        $("#id_portletcapability").attr("form", "id_clientform")
        $("#id_mobilecapability").attr("form", "id_clientform")

        //hide the delete button when instance is not saved yet.
        if ('{{clientform.instance.id}}' == 'None') {
            $("#btn_del").hide()
        }

        // submit the popup-butype-taform for validation and saving in db.
        $('#pop_butype_form').on('submit', sumit_popup_form({
            'url': "{{ url('onboarding:ta_popup') }}",
            'form': "#pop_butype_form",
            'field': "#id_identifier",
            'modal': "#butype_popup"
        }))
        //for select2 search work in bootstrap modals
        $("#pop_butype_form").find("select[name = tatype]").select2({
            dropdownParent: $('#pop_butype_form')
        })
        //sets closeonSelect to false for multiple-select fields
        $("[multiple]").select2({
            closeOnSelect:false 
        })

        //datatable  list of business units
        listbu_editor = new $.fn.dataTable.Editor({
            ajax: "{{ url('onboarding:list_bu') }}",
            table: "#list_bu",
            fields:[
                {label: 'Code', name: 'peoplecode'},
                {label: 'Name', name: 'peoplename'},
                {label: 'Login', name: 'loginid'},
                {label: 'Email', name: 'email'},
                {label: 'Mob No', name: 'mobno'},
                {label: 'Is Admin', name: 'isadmin'},
            ]
        })

        $("#list_bu").DataTable({
            ajax:{
                url: "{{ url('onboarding:list_bu') }}"
            },
            columns:[
                {data: 'id', defaulContent: "", visible:false},
                {data: 'peoplecode', title: 'Code'},
                {data: 'peoplename', title: 'Name'},
                {data: 'loginid', title: 'Login'},
                {data: 'email', title: 'Email'},
                {data: 'mobno', title: 'Mobile no'},
                {data: 'gender', title: 'Gender'},
                {data: 'isadmin', title: 'Is Admin'},
            ],
            deferRender: true,
			responsive : true,
            buttons: [
                { extend: "create", editor: editor },
                { extend: "edit",   editor: editor },
                { extend: "remove", editor: editor }
            ]
        })
       
    })
</script>
{% endblock extra_scripts %}